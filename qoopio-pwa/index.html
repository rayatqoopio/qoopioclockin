<!DOCTYPE html>
<html lang="="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>qoopioÊâìÂç°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icon-192.png" sizes="192x192" />
    <style>
      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 1.5rem;
        background-color: #f9f9f9;
        color: #333;
        text-align: center;
      }
      .container {
        max-width: 440px;
        margin: 20vh auto 0;
        transform: scale(1.8);
        transform-origin: top center;
      }
      #user-info {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1rem;
      }
      .button-row {
        display: flex;
        gap: 0.5rem;
      }
      .submit-btn {
        flex: 5;
        padding: 1rem;
        font-size: 1.5rem;
        background-color: #111;
        color: #fff;
        border: none;
        border-radius: 10px;
      }
      .change-btn {
        flex: 1;
        padding: 1rem;
        font-size: 1rem;
        background-color: #ccc;
        border: none;
        border-radius: 10px;
      }
      input[type="email"] {
        font-size: 1.2rem;
        padding: 1rem;
        width: 100%;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="user-info" style="display:none;">
        <span id="user-label"></span>
      </div>

      <div id="email-input-area">
        <label for="email">EmailÔºö</label>
        <input type="email" id="email" placeholder="Ëº∏ÂÖ•ÂÖ¨Âè∏ email" required />
      </div>

      <div class="button-row">
        <button id="clockInBtn" class="submit-btn" onclick="submitClockIn()">ÊâìÂç°</button>
        <button onclick="resetEmail()" class="change-btn">Êõ¥Êèõ</button>
      </div>

      <div id="status"></div>
    </div>

    <script>
      const nameMap = {
        "lilian6337@gmail.com": "Èô≥ÂΩ•Â¶Ç",
        "tiffany05141997@gmail.com": "Ë®±ÂÆáÁ¶é",
        "olaaaqoopio@gmail.com": "ÁéãÂΩ•Ëåπ",
        "violet.qoopio@gmail.com": "Ë≠öÈõØ",
        "ringo.qoopio0407@gmail.com": "ÁéãÂßùËòã",
        "rulinqoopio@gmail.com": "ÈªÉËåπÁê≥",
        "orange.at.qoopio@gmail.com": "ÂäâÂÆáÊô®",
        "xinyu881106.at.qoopio@gmail.com": "ÈÑ≠Èë´‰øû",
        "e3072029@gmail.com": "ÈªÉËæ∞Èà∫",
        "pegalt178y@gmail.com": "Âë®ÈúàÊ£ã",
        "ray.at.qoopio@gmail.com": "ÂëÇÊâøÂè°"
      };

      function getOrCreateDeviceId() {
        let uuid = localStorage.getItem("device_id");
        if (!uuid) {
          uuid = crypto.randomUUID();
          localStorage.setItem("device_id", uuid);
        }
        return uuid;
      }

      function showUserInfo(email) {
        const name = nameMap[email] || email;
        document.getElementById("user-label").textContent = `${name}Ôºà${email}Ôºâ`;
        document.getElementById("user-info").style.display = "block";
        document.getElementById("email-input-area").style.display = "none";
      }

      function showEmailInput() {
        document.getElementById("user-info").style.display = "none";
        document.getElementById("email-input-area").style.display = "block";
      }

      function resetEmail() {
        localStorage.removeItem("qoopio_email");
        location.reload();
      }

      function updateButtonLabel() {
        const now = new Date();
        const totalMinutes = now.getHours() * 60 + now.getMinutes();
        const btn = document.getElementById("clockInBtn");
        if (totalMinutes >= 240 && totalMinutes <= 1140) {
          btn.textContent = "‰∏äÁè≠ÊâìÂç°";
          btn.dataset.type = "‰∏äÁè≠";
        } else {
          btn.textContent = "‰∏ãÁè≠ÊâìÂç°";
          btn.dataset.type = "‰∏ãÁè≠";
        }
      }

      let lastSubmitTime = 0;

      function submitClockIn() {
        const now = Date.now();
        if (now - lastSubmitTime < 15000) {
          alert("Ë´ãÂãøÈáçË§áÊâìÂç°ÔºåË´ãÁ≠âÂæÖÂπæÁßíÂÜçË©¶ÔºÅ");
          return;
        }

        const email = localStorage.getItem("qoopio_email") || document.getElementById("email").value.trim();
        if (!email) return alert("Ë´ãËº∏ÂÖ• emailÔºÅ");
        localStorage.setItem("qoopio_email", email);

        const deviceId = getOrCreateDeviceId();
        console.log("üîë Device ID:", deviceId);
        updateButtonLabel();
        lastSubmitTime = now;

        const name = nameMap[email] || email;
        const type = document.getElementById("clockInBtn").dataset.type || "‰∏äÁè≠";
        const timeStr = new Date().toLocaleTimeString();
        const statusEl = document.getElementById("status");
        statusEl.textContent = `‚úÖ ${name} ${type}Ôºà${timeStr}Ôºâ`;
        statusEl.style.color = "green";

        // TODO: ÂèØÊé• Apps Script ÁöÑÂÇ≥ÈÄÅÈÇèËºØ
      }

      document.addEventListener("DOMContentLoaded", () => {
        const savedEmail = localStorage.getItem("qoopio_email");
        if (savedEmail) showUserInfo(savedEmail);
        else showEmailInput();

        updateButtonLabel();
        setInterval(updateButtonLabel, 60000);
      });
    </script>
  </body>
</html>
